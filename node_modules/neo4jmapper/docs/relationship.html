<!DOCTYPE html>

<html>
<head>
  <title>Relationship</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
      <ul id="jump_to">
        <li>
          <a class="large" href="javascript:void(0);">Jump To &hellip;</a>
          <a class="small" href="javascript:void(0);">+</a>
          <div id="jump_wrapper">
          <div id="jump_page">
            
              
              <a class="source" href="conditionalparameters.html">
                conditionalparameters.js
              </a>
            
              
              <a class="source" href="cypherquery.html">
                cypherquery.js
              </a>
            
              
              <a class="source" href="graph.html">
                graph.js
              </a>
            
              
              <a class="source" href="helpers.html">
                helpers.js
              </a>
            
              
              <a class="source" href="index.html">
                index.js
              </a>
            
              
              <a class="source" href="neo4jrestful.html">
                neo4jrestful.js
              </a>
            
              
              <a class="source" href="node.html">
                node.js
              </a>
            
              
              <a class="source" href="path.html">
                path.js
              </a>
            
              
              <a class="source" href="relationship.html">
                relationship.js
              </a>
            
              
              <a class="source" href="transaction.html">
                transaction.js
              </a>
            
          </div>
        </li>
      </ul>
    
    <ul class="sections">
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap for-h1">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              <h1>Relationship</h1>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="comment">/*
 * TODO:
 * * make query mapper from Node available for relationships as well
 * * make relationships queryable with custom queries
 */</span>

<span class="keyword">var</span> __initRelationship__ = <span class="keyword">function</span>(neo4jrestful, Graph, Node) {


  <span class="keyword">if</span> (<span class="keyword">typeof</span> window === <span class="string">'object'</span>) {
    <span class="keyword">var</span> helpers = window.Neo4jMapper.helpers;
    <span class="keyword">var</span> _       = window._;
  } <span class="keyword">else</span> {
    <span class="keyword">var</span> helpers  = require(<span class="string">'./helpers'</span>);
    <span class="keyword">var</span> _        = require(<span class="string">'underscore'</span>);
  }</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>Constructor of Relationship</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  <span class="keyword">var</span> Relationship = <span class="function"><span class="keyword">function</span> <span class="title">Relationship</span><span class="params">(type, data, start, end, id, cb)</span> {</span>
    <span class="keyword">this</span>.type = <span class="keyword">this</span>._type_ = type || <span class="literal">null</span>;
    <span class="keyword">this</span>.from = {
      id: <span class="literal">null</span>,
      uri: <span class="literal">null</span>
    };
    <span class="keyword">this</span>.to = {
      id: <span class="literal">null</span>,
      uri: <span class="literal">null</span>
    };
    <span class="keyword">this</span>.data = data || {};

    <span class="keyword">var</span> startID = <span class="literal">null</span>;
    <span class="keyword">var</span> endID = <span class="literal">null</span>;

    <span class="keyword">if</span> (start)
      <span class="keyword">if</span> (Number(start.id))
        startID = Number(start.id);
      <span class="keyword">else</span> <span class="keyword">if</span> (Number(start))
        startID = Number(start);
      <span class="keyword">else</span> <span class="keyword">if</span> (start)</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>we assume we have a url here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.setPointIdByUri(<span class="string">'from'</span>, start);

    <span class="keyword">if</span> (startID)
      <span class="keyword">this</span>.setPointUriById(<span class="string">'from'</span>, startID);

    <span class="keyword">if</span> (end)
      <span class="keyword">if</span> (Number(end.id))
        endID = Number(end.id);
      <span class="keyword">else</span> <span class="keyword">if</span> (Number(end))
        endID = Number(end);
      <span class="keyword">else</span> <span class="keyword">if</span> (end)</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>we assume we have a url here</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">this</span>.setPointIdByUri(<span class="string">'to'</span>, end);

    <span class="keyword">if</span> (endID)
      <span class="keyword">this</span>.setPointUriById(<span class="string">'to'</span>, endID);

    <span class="keyword">this</span>.fields = _.extend({},{
      defaults: _.extend({}, <span class="keyword">this</span>.fields.defaults),
      indexes: _.extend({}, <span class="keyword">this</span>.fields.indexes) <span class="comment">// TODO: implement</span>
    });

    <span class="keyword">this</span>._is_instanced_ = <span class="literal">true</span>;

    <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">'number'</span>) {
      <span class="keyword">this</span>.setUriById(id);
      <span class="keyword">this</span>.id = <span class="keyword">this</span>._id_ = id;
    } <span class="keyword">else</span> {
      cb = id;
    }
    <span class="keyword">if</span> (<span class="keyword">typeof</span> cb === <span class="string">'function'</span>) {
      <span class="keyword">return</span> <span class="keyword">this</span>.save(cb);
    }
  }

  Relationship.prototype.classification   = <span class="string">'Relationship'</span>; <span class="comment">// only needed for toObject()</span>
  Relationship.prototype.data             = {};
  Relationship.prototype.start            = <span class="literal">null</span>;
  Relationship.prototype.type             = <span class="literal">null</span>;
  Relationship.prototype._type_           = <span class="literal">null</span>;           <span class="comment">// like `_id_` to keep a reference to the legacy type</span>
  Relationship.prototype.end              = <span class="literal">null</span>;
  Relationship.prototype.from             = <span class="literal">null</span>;
  Relationship.prototype.to               = <span class="literal">null</span>;
  Relationship.prototype.id               = <span class="literal">null</span>;
  Relationship.prototype._id_             = <span class="literal">null</span>;
  Relationship.prototype._hashedData_     = <span class="literal">null</span>;
  Relationship.prototype.uri              = <span class="literal">null</span>;
  Relationship.prototype._response_       = <span class="literal">null</span>;
  Relationship.prototype._is_singleton_   = <span class="literal">false</span>;
  Relationship.prototype._is_persisted_   = <span class="literal">false</span>;
  Relationship.prototype.cypher           = <span class="literal">null</span>;
  Relationship.prototype._is_instanced_   = <span class="literal">null</span>;
  Relationship.prototype.fields = {
    defaults: {},
    indexes: {}
  };</pre></div></div>
            
        </li>
        
        
        <li id="section-5">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-5">&#182;</a>
              </div>
              <p>should <strong>never</strong> be changed</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Relationship.prototype.__TYPE__ = <span class="string">'relationship'</span>;
  Relationship.prototype.__TYPE_IDENTIFIER__ = <span class="string">'r'</span>;

  Relationship.prototype.singleton = <span class="keyword">function</span>(id) {
    <span class="keyword">var</span> relationship = <span class="keyword">new</span> Relationship();
    <span class="keyword">if</span> (<span class="keyword">typeof</span> id === <span class="string">'number'</span>) {
      <span class="keyword">this</span>.id = <span class="keyword">this</span>._id_ = id;
    }
    relationship._is_singleton_ = <span class="literal">true</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-6">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-6">&#182;</a>
              </div>
              <p>relationship.resetQuery();</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">return</span> relationship;
  }

  Relationship.singleton = <span class="keyword">function</span>(id) {
    <span class="keyword">return</span> <span class="keyword">this</span>.prototype.singleton(id);
  }

  Relationship.prototype.setPointUriById = <span class="keyword">function</span>(startOrEnd, id) {
    <span class="keyword">if</span> (<span class="keyword">typeof</span> startOrEnd !== <span class="string">'string'</span>)
      startOrEnd = <span class="string">'from'</span>;
    <span class="keyword">if</span> ((startOrEnd !== <span class="string">'from'</span>)&amp;&amp;(startOrEnd !== <span class="string">'to'</span>))
      <span class="keyword">throw</span> Error(<span class="string">"You have to set startOrEnd argument to 'from' or 'to'"</span>);
    <span class="keyword">if</span> (_.isNumber(id)) {
      <span class="keyword">this</span>[startOrEnd].uri = neo4jrestful.absoluteUrl(<span class="string">'/relationship/'</span>+id);
      <span class="keyword">this</span>[startOrEnd].id = id;
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Relationship.prototype.setPointIdByUri = <span class="keyword">function</span>(startOrEnd, uri) {
    <span class="keyword">if</span> (<span class="keyword">typeof</span> startOrEnd !== <span class="string">'string'</span>)
      startOrEnd = <span class="string">'from'</span>;
    <span class="keyword">if</span> ((startOrEnd !== <span class="string">'from'</span>)&amp;&amp;(startOrEnd !== <span class="string">'to'</span>))
      <span class="keyword">throw</span> Error(<span class="string">"You have to set startOrEnd argument to 'from' or 'to'"</span>);
    <span class="keyword">if</span> (uri.match(<span class="regexp">/[0-9]+$/</span>)) {
      <span class="keyword">this</span>[startOrEnd].uri = uri;
      <span class="keyword">this</span>[startOrEnd].id = Number(uri.match(<span class="regexp">/[0-9]+$/</span>)[<span class="number">0</span>]);
    }
  }

  Relationship.prototype.applyDefaultValues = <span class="literal">null</span>; <span class="comment">// will be initialized</span>

  Relationship.prototype.findById = <span class="keyword">function</span>(id, cb) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">if</span> ( (_.isNumber(Number(id))) &amp;&amp; (<span class="keyword">typeof</span> cb === <span class="string">'function'</span>) ) {</pre></div></div>
            
        </li>
        
        
        <li id="section-7">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-7">&#182;</a>
              </div>
              <p>to reduce calls we&#39;ll make a specific restful request for one node</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">return</span> Graph.request().get(<span class="keyword">this</span>.__TYPE__+<span class="string">'/'</span>+id, <span class="keyword">function</span>(err, object) {
        <span class="keyword">if</span> ((object) &amp;&amp; (<span class="keyword">typeof</span> self.load === <span class="string">'function'</span>)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-8">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-8">&#182;</a>
              </div>
              <p> &amp;&amp; (typeof node.load === &#39;function&#39;)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>          object.load(cb);
        } <span class="keyword">else</span> {
          cb(err, object);
        }
      });
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Relationship.prototype.save = <span class="keyword">function</span>(cb) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    self.onBeforeSave(self, <span class="keyword">function</span>(err) {</pre></div></div>
            
        </li>
        
        
        <li id="section-9">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-9">&#182;</a>
              </div>
              <p>don&#39;t execute if an error is passed through</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      <span class="keyword">if</span> ((<span class="keyword">typeof</span> err !== <span class="string">'undefined'</span>)&amp;&amp;(err !== <span class="literal">null</span>))
        cb(err, <span class="literal">null</span>);
      <span class="keyword">else</span>
        self.onSave(<span class="keyword">function</span>(err, relationship, debug) {
          <span class="keyword">if</span> (err)
            <span class="keyword">return</span> cb(err, relationship, debug);
          <span class="keyword">else</span>
            <span class="keyword">return</span> self.onAfterSave(self, cb, debug);
        });
    });
  }

  Relationship.prototype.onSave = <span class="keyword">function</span>(cb) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">if</span> (<span class="keyword">this</span>._is_singleton_)
      <span class="keyword">return</span> cb(Error(<span class="string">'Singleton instances can not be persisted'</span>), <span class="literal">null</span>);
    <span class="keyword">if</span> (!<span class="keyword">this</span>.hasValidData())
      <span class="keyword">return</span> cb(Error(<span class="string">'relationship does not contain valid data. `'</span>+<span class="keyword">this</span>.__TYPE__+<span class="string">'.data` must be an object.'</span>));
    <span class="keyword">this</span>.resetQuery();
    <span class="keyword">this</span>.applyDefaultValues();

    <span class="keyword">this</span>.id = <span class="keyword">this</span>._id_;

    <span class="keyword">if</span> (!<span class="keyword">this</span>.type)
      <span class="keyword">throw</span> Error(<span class="string">"Type for a relationship is mandatory, e.g. `relationship.type = 'KNOW'`"</span>);
    <span class="keyword">if</span> ((!(<span class="keyword">this</span>.from))||(isNaN(<span class="keyword">this</span>.from.id)))
      <span class="keyword">throw</span> Error(<span class="string">'Relationship requires a `relationship.from` startnode'</span>);
    <span class="keyword">if</span> ((!(<span class="keyword">this</span>.to))||(isNaN(<span class="keyword">this</span>.to.id)))
      <span class="keyword">throw</span> Error(<span class="string">'Relationship requires a `relationship.to` endnode'</span>);

    <span class="keyword">if</span> (<span class="keyword">this</span>.hasId()) {

      <span class="keyword">if</span> ((<span class="keyword">this</span>._type_) &amp;&amp; (<span class="keyword">this</span>.type !== <span class="keyword">this</span>._type_)) {</pre></div></div>
            
        </li>
        
        
        <li id="section-10">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-10">&#182;</a>
              </div>
              <p>type has changed
since we can&#39;t update a relationship type (only properties)
we have to create a new relationship and delete the &quot;old&quot; one</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>        <span class="keyword">return</span> Relationship.create(<span class="keyword">this</span>.type, <span class="keyword">this</span>.data, <span class="keyword">this</span>.start, <span class="keyword">this</span>.end, <span class="keyword">function</span>(err, relationship, debug) {
          <span class="keyword">if</span> (err) {
            <span class="keyword">return</span> cb(err, relationship, debug);
          } <span class="keyword">else</span> {
            self.remove(<span class="keyword">function</span>(err, res, debugDelete) {
              <span class="keyword">if</span> (err) {
                <span class="keyword">return</span> cb(err, res, debugDelete);
              } <span class="keyword">else</span> {
                relationship.copyTo(self);
                <span class="keyword">return</span> cb(<span class="literal">null</span>, self, debug);
              }
            })
          }
        })
      }</pre></div></div>
            
        </li>
        
        
        <li id="section-11">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-11">&#182;</a>
              </div>
              <p>UPDATE properties
url = &#39;relationship/&#39;+this.<em>id</em>+&#39;/properties&#39;;</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>      Graph
        .start(<span class="string">'r = relationship({id})'</span>, {
          id: Number(<span class="keyword">this</span>.id),
        })
        .setWith( { r: <span class="keyword">this</span>.dataForCypher() } )
        .<span class="keyword">return</span>(<span class="string">'r'</span>)
        .exec(cb);
    } <span class="keyword">else</span> {
      Graph
        .start(<span class="string">'n = node({from}), m = node({to})'</span>, {
          from: Number(<span class="keyword">this</span>.from.id),
          to: Number(<span class="keyword">this</span>.to.id),
        })
        .create([ <span class="string">'(n)-[r: '</span>+helpers.escapeProperty(<span class="keyword">this</span>.type), <span class="keyword">this</span>.dataForCypher(), <span class="string">']-&gt;(m)'</span>])
        .<span class="keyword">return</span>(<span class="string">'r'</span>)
        .limit(<span class="number">1</span>)
        .exec(<span class="keyword">function</span>(err, relationship, debug) {
          <span class="keyword">if</span> ((err) || (!relationship))
            <span class="keyword">return</span> cb(err, relationship, debug);
          <span class="keyword">else</span> {
            relationship.copyTo(self);
            <span class="keyword">return</span> cb(<span class="literal">null</span>, self, debug);
          }
        });
    }
  }

  Relationship.prototype.update = <span class="keyword">function</span>(data, cb) {
    <span class="keyword">if</span> (helpers.isObjectLiteral(data)) {
      <span class="keyword">this</span>.data = _.extend(<span class="keyword">this</span>.data, data);
      data = <span class="keyword">this</span>.flattenData();
    } <span class="keyword">else</span> {
      cb = data;
    }
    <span class="keyword">return</span> <span class="keyword">this</span>.save(cb);
  }

  Relationship.prototype.populateWithDataFromResponse = <span class="keyword">function</span>(data, create) {
    create = (<span class="keyword">typeof</span> create !== <span class="string">'undefined'</span>) ? create : <span class="literal">false</span>;</pre></div></div>
            
        </li>
        
        
        <li id="section-12">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-12">&#182;</a>
              </div>
              <p>if we are working on the prototype object
we won&#39;t mutate it and create a new relationship instance insetad</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    <span class="keyword">var</span> relationship = (<span class="keyword">this</span>._is_instanced_ !== <span class="literal">null</span>) ? <span class="keyword">this</span> : <span class="keyword">new</span> Relationship();
    <span class="keyword">if</span> (create)
      relationship = <span class="keyword">new</span> Relationship();
    <span class="keyword">if</span> (data) {
      <span class="keyword">if</span> (_.isObject(data) &amp;&amp; (!_.isArray(data)))
        relationship._response_ = data;
      <span class="keyword">else</span>
        relationship._response_ = data[<span class="number">0</span>];
      relationship.data = relationship._response_.data;
      relationship.data = helpers.unflattenObject(<span class="keyword">this</span>.data);
      relationship.uri  = relationship._response_.self;
      relationship.type = relationship._type_ = relationship._response_.type;
      <span class="keyword">if</span> ((relationship._response_.self) &amp;&amp; (relationship._response_.self.match(<span class="regexp">/[0-9]+$/</span>))) {
        relationship.id = relationship._id_ = Number(relationship._response_.self.match(<span class="regexp">/[0-9]+$/</span>)[<span class="number">0</span>]);
      }
      <span class="keyword">if</span> ((relationship._response_.start) &amp;&amp; (relationship._response_.start.match(<span class="regexp">/[0-9]+$/</span>))) {
        relationship.from.uri = relationship.start = relationship._response_.start;
        relationship.setPointIdByUri(<span class="string">'from'</span>, relationship._response_.start);
      }
      <span class="keyword">if</span> ((relationship._response_.end) &amp;&amp; (relationship._response_.end.match(<span class="regexp">/[0-9]+$/</span>))) {
        relationship.to.uri = relationship.end = relationship._response_.end;
        relationship.setPointIdByUri(<span class="string">'to'</span>, relationship._response_.end);
      }
    }
    relationship._is_persisted_ = <span class="literal">true</span>;
    relationship.isPersisted(<span class="literal">true</span>);
    <span class="keyword">return</span> relationship;
  }

  Relationship.prototype.remove = <span class="keyword">function</span>(cb) {
    <span class="keyword">if</span> (<span class="keyword">this</span>._is_singleton_)
      <span class="keyword">return</span> cb(Error(<span class="string">"To delete results of a query use delete(). remove() is for removing a relationship."</span>),<span class="literal">null</span>);
    <span class="keyword">if</span> (<span class="keyword">this</span>.hasId()) {
      <span class="keyword">return</span> Graph.request().<span class="keyword">delete</span>(<span class="string">'relationship/'</span>+<span class="keyword">this</span>.id, cb);
    }
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Relationship.prototype.loadFromAndToNodes = <span class="keyword">function</span>(cb) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">var</span> attributes = [<span class="string">'from'</span>, <span class="string">'to'</span>];
    <span class="keyword">var</span> done = <span class="number">0</span>;
    <span class="keyword">var</span> errors = [];
    <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) {
      (<span class="keyword">function</span>(point){
        Node.findById(self[point].id,<span class="keyword">function</span>(err,node) {
          self[point] = node;
          <span class="keyword">if</span> (err)
            errors.push(err);
          done++;
          <span class="keyword">if</span> (done === <span class="number">2</span>) {
            cb((errors.length === <span class="number">0</span>) ? <span class="literal">null</span> : errors, self);
          }

        });
      })(attributes[i]);
    }
  }

  Relationship.prototype.load = <span class="keyword">function</span>(cb) {
    <span class="keyword">var</span> self = <span class="keyword">this</span>;
    <span class="keyword">this</span>._onBeforeLoad(self, <span class="keyword">function</span>(err, relationship){
      <span class="keyword">if</span> (err)
        cb(err, relationship);
      <span class="keyword">else</span>
        self._onAfterLoad(relationship, cb);
    })
  }

  Relationship.prototype._onBeforeLoad = <span class="keyword">function</span>(relationship, next) {
    <span class="keyword">return</span> <span class="keyword">this</span>.onBeforeLoad(relationship, <span class="keyword">function</span>(err, relationship) {
      <span class="keyword">if</span> (relationship.hasId()) {
        relationship.loadFromAndToNodes(<span class="keyword">function</span>(err, relationship){
          next(err, relationship);
        });
      } <span class="keyword">else</span> {
        next(<span class="literal">null</span>, relationship);
      }
    });
  }

  Relationship.prototype.onBeforeLoad = <span class="keyword">function</span>(relationship, next) {
    <span class="keyword">return</span> next(<span class="literal">null</span>, relationship);
  }

  Relationship.prototype._onAfterLoad = <span class="keyword">function</span>(relationship, next) {
    <span class="keyword">return</span> <span class="keyword">this</span>.onAfterLoad(relationship, <span class="keyword">function</span>(err, relationship) {
      <span class="keyword">return</span> next(<span class="literal">null</span>, relationship);
    })
  }

  Relationship.prototype.onAfterLoad = <span class="keyword">function</span>(relationship, next) {
    <span class="keyword">return</span> next(<span class="literal">null</span>, relationship);
  }

  Relationship.prototype.toQuery = <span class="keyword">function</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.hasId()) {
      <span class="keyword">return</span> Graph
        .start(<span class="string">'r = relationship('</span>+<span class="keyword">this</span>.id+<span class="string">')'</span>)
        .<span class="keyword">return</span>(<span class="string">'r'</span>).toQuery();
    }
    <span class="keyword">return</span> Graph.start(<span class="string">'r = relationship(*)'</span>).toQuery();
  }

  Relationship.prototype.toQueryString = Node.prototype.toQueryString;

  Relationship.prototype.toCypherQuery = Node.prototype.toCypherQuery;

  Relationship.prototype.toObject = <span class="keyword">function</span>() {
    <span class="keyword">var</span> o = {
      id: <span class="keyword">this</span>.id,
      classification: <span class="keyword">this</span>.classification,
      data: _.clone(<span class="keyword">this</span>.data),
      start: <span class="keyword">this</span>.start,
      end: <span class="keyword">this</span>.end,
      from: _.extend(<span class="keyword">this</span>.from),
      to: _.extend(<span class="keyword">this</span>.to),
      uri: <span class="keyword">this</span>.uri,
      type: <span class="keyword">this</span>.type
    };
    <span class="keyword">if</span> ( (o.from) &amp;&amp; (<span class="keyword">typeof</span> o.from.toObject === <span class="string">'function'</span>) )
      o.from = o.from.toObject();
    <span class="keyword">if</span> ( (o.to)   &amp;&amp; (<span class="keyword">typeof</span> o.to.toObject === <span class="string">'function'</span>) )
      o.to   = o.to.toObject();
    <span class="keyword">return</span> o;
  }

  Relationship.prototype._hashData_ = <span class="keyword">function</span>() {
    <span class="keyword">if</span> (<span class="keyword">this</span>.hasValidData())
      <span class="keyword">return</span> helpers.md5(JSON.stringify(<span class="keyword">this</span>.toObject()));
    <span class="keyword">else</span>
      <span class="keyword">return</span> <span class="literal">null</span>;
  }

  Relationship.prototype.onBeforeSave = <span class="keyword">function</span>(node, next) {
    next(<span class="literal">null</span>, <span class="literal">null</span>);
  }

  Relationship.prototype.onAfterSave = <span class="keyword">function</span>(relationship, next, debug) {
    <span class="keyword">return</span> next(<span class="literal">null</span>, relationship, debug);
  }

  Relationship.prototype.resetQuery = <span class="keyword">function</span>() {
    <span class="keyword">this</span>.cypher = <span class="keyword">new</span> helpers.CypherQuery();
    <span class="keyword">return</span> <span class="keyword">this</span>;
  }

  Relationship.prototype._load_hook_reference_  = <span class="literal">null</span>;

  <span class="comment">/*
   * Static singleton methods
   */</span>

  Relationship.findById = <span class="keyword">function</span>(id, cb) {
    <span class="keyword">return</span> Relationship.singleton().findById(id, cb);
  }

  Relationship.recommendConstructor = <span class="keyword">function</span>() {
    <span class="keyword">return</span> Relationship;
  }


  <span class="comment">/* from Node */</span>
  Relationship.prototype.applyDefaultValues = Node.prototype.applyDefaultValues</pre></div></div>
            
        </li>
        
        
        <li id="section-13">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-13">&#182;</a>
              </div>
              <p>Copys only the node&#39;s relevant data(s) to another object</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>  Relationship.prototype.copyTo = <span class="keyword">function</span>(r) {
    r.id = r._id_ = <span class="keyword">this</span>._id_;
    r.data   = _.clone(<span class="keyword">this</span>.data);
    r.uri = <span class="keyword">this</span>.uri;
    r._response_ = _.clone(<span class="keyword">this</span>._response_);
    r.from = _.clone(<span class="keyword">this</span>.from);
    r.to = _.clone(<span class="keyword">this</span>.to);
    r.start = <span class="keyword">this</span>.start;
    r.end = <span class="keyword">this</span>.end;
    r.type = r._type_ = <span class="keyword">this</span>._type_;
    <span class="keyword">return</span> r;
  }

  Relationship.prototype.hasValidData     = Node.prototype.hasValidData;
  Relationship.prototype.flattenData      = Node.prototype.flattenData;
  Relationship.prototype.setUriById       = Node.prototype.setUriById;
  Relationship.prototype.isPersisted      = Node.prototype.isPersisted;
  Relationship.prototype.hasId            = Node.prototype.hasId;
  Relationship.prototype.dataForCypher    = Node.prototype.dataForCypher;

  Relationship.setDefaultFields            = Node.setDefaultFields;
  Relationship.setIndexFields              = Node.setIndexFields;
  Relationship.setUniqueFields             = Node.setUniqueFields;
  Relationship._setModelFields             = Node._setModelFields;

  Relationship.<span class="keyword">new</span> = <span class="keyword">function</span>(type, data, start, end, id, cb) {
    <span class="keyword">return</span> <span class="keyword">new</span> Relationship(type, data, start, end, id, cb);
  }

  Relationship.create = Relationship.<span class="keyword">new</span>;

  <span class="keyword">return</span> neo4jrestful.Relationship = Relationship;
}

<span class="keyword">if</span> (<span class="keyword">typeof</span> window !== <span class="string">'object'</span>) {
  module.exports = exports = {
    init: __initRelationship__
  }
} <span class="keyword">else</span> {
  window.Neo4jMapper.initRelationship = __initRelationship__;
}</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
